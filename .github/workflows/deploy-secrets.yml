name: Deploy Secrets

on:
  workflow_call:

jobs:
  deploy-secrets-job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Deploy Secrets
        run: |
          cd ops/cfn
          ls
          aws cloudformation deploy \
          --stack-name ${{ env.STACK_NAME }} \
          --template-file secrets.cfn.yml \
          --region ${{ env.AWS_REGION }} \
          --capabilities CAPABILITY_IAM \
          --no-fail-on-empty-changeset \
          --parameter-overrides \
            Universe=${{ github.event.inputs.Universe }} \
            AccessToken=${{ env.Access_Token }} \
            ApiKey=${{ env.API_PASSWORD }} \
          --tags \
            bv:nexus:team=${{ env.TEAM }} \
            bv:nexus:vpc=1233 \
            bv:system=emodb \
            bv:nexus:service=${{vars.SERVICE}} \
            bv:nexus:owner=${{ env.TEAM }} \
            bv:nexus:costcenter=${{ env.TEAM }} \
            bv:nexus:datatype=${{ env.DATATYPE }} \
            bv:nexus:env=1234
